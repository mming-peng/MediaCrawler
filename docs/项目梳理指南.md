# MediaCrawler é¡¹ç›®æ¢³ç†æ–‡æ¡£

## ğŸ“Œ é¡¹ç›®æ¦‚è¿°

MediaCrawler æ˜¯ä¸€ä¸ª**å¤šå¹³å°è‡ªåª’ä½“æ•°æ®é‡‡é›†å·¥å…·**ï¼Œæ”¯æŒ7ä¸ªä¸»æµå¹³å°çš„å…¬å¼€æ•°æ®æŠ“å–ï¼š

| å¹³å° | ä»£å· | æ”¯æŒåŠŸèƒ½ |
|------|------|----------|
| å°çº¢ä¹¦ | `xhs` | å…³é”®è¯æœç´¢ã€å¸–å­è¯¦æƒ…ã€åˆ›ä½œè€…ä¸»é¡µã€è¯„è®ºçˆ¬å– |
| æŠ–éŸ³ | `dy` | åŒä¸Š |
| å¿«æ‰‹ | `ks` | åŒä¸Š |
| Bç«™ | `bili` | åŒä¸Š |
| å¾®åš | `wb` | åŒä¸Š |
| è´´å§ | `tieba` | åŒä¸Š |
| çŸ¥ä¹ | `zhihu` | åŒä¸Š |

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒæµç¨‹å›¾

```mermaid
flowchart TB
    subgraph å…¥å£
        A[main.py] --> B[CrawlerFactory]
    end
    
    subgraph çˆ¬è™«å±‚
        B --> C1[XiaoHongShuCrawler]
        B --> C2[DouYinCrawler]
        B --> C3[å…¶ä»–å¹³å°...]
    end
    
    subgraph æ ¸å¿ƒç»„ä»¶
        C1 --> D1[XiaoHongShuClient APIå®¢æˆ·ç«¯]
        C1 --> D2[XiaoHongShuLogin ç™»å½•æ¨¡å—]
        C1 --> D3[ç­¾åæ¨¡å— xhs_sign.py]
    end
    
    subgraph æ•°æ®å±‚
        D1 --> E1[store å­˜å‚¨å±‚]
        E1 --> F1[CSV]
        E1 --> F2[JSON]
        E1 --> F3[Excel]
        E1 --> F4[SQLite/MySQL]
    end
    
    subgraph æ”¯æ’‘å±‚
        G1[config é…ç½®] --> C1
        G2[proxy ä»£ç†æ± ] --> D1
        G3[tools å·¥å…·ç±»] --> C1
    end
```

### ä»£ç åˆ†å±‚

| å±‚çº§ | ç›®å½• | èŒè´£ |
|------|------|------|
| **å…¥å£å±‚** | `main.py` | ç¨‹åºå…¥å£ï¼Œå‘½ä»¤è¡Œè§£æï¼Œçˆ¬è™«å·¥å‚ |
| **é…ç½®å±‚** | `config/` | å¹³å°é…ç½®ã€æ•°æ®åº“é…ç½®ã€ä»£ç†é…ç½® |
| **çˆ¬è™«å±‚** | `media_platform/` | å„å¹³å°çˆ¬è™«æ ¸å¿ƒå®ç° |
| **å­˜å‚¨å±‚** | `store/` | CSV/JSON/Excel/DB å¤šç§å­˜å‚¨æ”¯æŒ |
| **æ¨¡å‹å±‚** | `model/` | æ•°æ®ç»“æ„å®šä¹‰ï¼ˆPydanticï¼‰ |
| **å·¥å…·å±‚** | `tools/` | CDPæµè§ˆå™¨ã€æ»‘å—éªŒè¯ã€å·¥å…·å‡½æ•° |
| **ä»£ç†å±‚** | `proxy/` | IPä»£ç†æ± ç®¡ç† |
| **æ•°æ®åº“å±‚** | `database/` | ORM æ¨¡å‹ä¸ä¼šè¯ç®¡ç† |
| **åŸºç±»å±‚** | `base/` | æŠ½è±¡åŸºç±»å®šä¹‰ |

---

## ğŸ“ æ ¸å¿ƒç›®å½•è¯¦è§£

### 1. `media_platform/xhs/` - å°çº¢ä¹¦æ¨¡å—ï¼ˆä»¥æ­¤ä¸ºä¾‹ï¼‰

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `core.py` | **çˆ¬è™«æ ¸å¿ƒ**ï¼š`XiaoHongShuCrawler` ç±»ï¼Œå®ç° search/detail/creator ä¸‰ç§çˆ¬å–æ¨¡å¼ |
| `client.py` | **APIå®¢æˆ·ç«¯**ï¼šå°è£…å°çº¢ä¹¦æ¥å£è¯·æ±‚ï¼Œå¤„ç†ç­¾å |
| `login.py` | **ç™»å½•æ¨¡å—**ï¼šäºŒç»´ç ç™»å½•ã€æ‰‹æœºå·ç™»å½•ã€Cookieç™»å½• |
| `xhs_sign.py` | **ç­¾åç”Ÿæˆ**ï¼šé€šè¿‡ JS æ‰§è¡Œè·å–è¯·æ±‚ç­¾å |
| `help.py` | **è¾…åŠ©å‡½æ•°**ï¼šURLè§£æã€æœç´¢IDç”Ÿæˆç­‰ |
| `field.py` | **å­—æ®µå®šä¹‰**ï¼šæœç´¢æ’åºç±»å‹ç­‰æšä¸¾ |

### 2. `config/` - é…ç½®ç®¡ç†

| æ–‡ä»¶ | å…³é”®é…ç½®é¡¹ |
|------|-----------|
| `base_config.py` | `PLATFORM`ï¼ˆå¹³å°é€‰æ‹©ï¼‰ã€`KEYWORDS`ï¼ˆæœç´¢å…³é”®è¯ï¼‰ã€`CRAWLER_TYPE`ï¼ˆçˆ¬å–æ¨¡å¼ï¼‰ã€`SAVE_DATA_OPTION`ï¼ˆå­˜å‚¨æ–¹å¼ï¼‰|
| `xhs_config.py` | å°çº¢ä¹¦ä¸“å±é…ç½®ï¼šå¸–å­IDåˆ—è¡¨ã€åˆ›ä½œè€…é“¾æ¥ç­‰ |
| `db_config.py` | MySQL/SQLite è¿æ¥é…ç½® |

### 3. `tools/` - å·¥å…·ç±»

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `cdp_browser.py` | CDPæµè§ˆå™¨ç®¡ç†å™¨ï¼šä½¿ç”¨ç”¨æˆ·çœŸå®æµè§ˆå™¨ï¼Œæä¾›æ›´å¥½çš„åæ£€æµ‹èƒ½åŠ› |
| `browser_launcher.py` | æµè§ˆå™¨å¯åŠ¨å™¨ |
| `slider_util.py` | æ»‘å—éªŒè¯ç å¤„ç† |
| `crawler_util.py` | çˆ¬è™«å·¥å…·å‡½æ•° |

---

## ğŸš€ å¿«é€Ÿä¸Šæ‰‹

### å®‰è£…ä¾èµ–
```bash
cd MediaCrawler
uv sync                    # å®‰è£… Python ä¾èµ–
uv run playwright install  # å®‰è£…æµè§ˆå™¨é©±åŠ¨
```

### è¿è¡Œçˆ¬è™«
```bash
# å…³é”®è¯æœç´¢ï¼ˆä¿®æ”¹ config/base_config.py ä¸­çš„ KEYWORDSï¼‰
uv run main.py --platform xhs --lt qrcode --type search

# çˆ¬å–æŒ‡å®šå¸–å­ï¼ˆéœ€åœ¨ config/xhs_config.py é…ç½®å¸–å­IDï¼‰
uv run main.py --platform xhs --lt qrcode --type detail

# çˆ¬å–åˆ›ä½œè€…ä¸»é¡µ
uv run main.py --platform xhs --lt qrcode --type creator
```

### é…ç½®è¦ç‚¹

æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š`config/base_config.py`

```python
PLATFORM = "xhs"                    # ç›®æ ‡å¹³å°
KEYWORDS = "ç¼–ç¨‹å‰¯ä¸š,ç¼–ç¨‹å…¼èŒ"       # æœç´¢å…³é”®è¯
CRAWLER_TYPE = "search"             # çˆ¬å–ç±»å‹ï¼šsearch/detail/creator
SAVE_DATA_OPTION = "json"           # å­˜å‚¨æ–¹å¼ï¼šcsv/json/excel/db/sqlite
ENABLE_GET_COMMENTS = True          # æ˜¯å¦çˆ¬å–è¯„è®º
ENABLE_CDP_MODE = True              # æ˜¯å¦ä½¿ç”¨ CDP æ¨¡å¼ï¼ˆæ¨èï¼‰
```

---

## ğŸ“Š æ•°æ®å­˜å‚¨

æ•°æ®ä¿å­˜åœ¨ `data/{platform}/{format}/` ç›®å½•ä¸‹ï¼š

```
data/
â”œâ”€â”€ xhs/
â”‚   â”œâ”€â”€ json/
â”‚   â”‚   â”œâ”€â”€ search_contents_2025-12-11.json    # å¸–å­å†…å®¹
â”‚   â”‚   â””â”€â”€ search_comments_2025-12-11.json    # è¯„è®ºæ•°æ®
â”‚   â”œâ”€â”€ csv/
â”‚   â””â”€â”€ excel/
â””â”€â”€ ...
```

---

## ğŸ”§ å¼€å‘æ‰©å±•

### æ·»åŠ æ–°å¹³å°

1. åœ¨ `media_platform/` ä¸‹åˆ›å»ºæ–°ç›®å½•
2. å®ç° `AbstractCrawler` åŸºç±»ï¼ˆå‚è€ƒ `base/base_crawler.py`ï¼‰
3. å®ç°æ ¸å¿ƒæ–¹æ³•ï¼š`start()`ã€`search()`ã€`launch_browser()`
4. åœ¨ `main.py` çš„ `CrawlerFactory.CRAWLERS` ä¸­æ³¨å†Œ

### æŠ½è±¡åŸºç±»

```python
# base/base_crawler.py
class AbstractCrawler(ABC):
    async def start(self): ...      # å¯åŠ¨çˆ¬è™«
    async def search(self): ...     # å…³é”®è¯æœç´¢
    async def launch_browser(self, ...): ...  # å¯åŠ¨æµè§ˆå™¨

class AbstractLogin(ABC):
    async def login_by_qrcode(self): ...    # äºŒç»´ç ç™»å½•
    async def login_by_mobile(self): ...    # æ‰‹æœºå·ç™»å½•
    async def login_by_cookies(self): ...   # Cookieç™»å½•

class AbstractStore(ABC):
    async def store_content(self, content_item): ...  # å­˜å‚¨å†…å®¹
    async def store_comment(self, comment_item): ...  # å­˜å‚¨è¯„è®º
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´æ–‡æ¡£ç«™ç‚¹](https://nanmicoder.github.io/MediaCrawler/)
- [CDPæ¨¡å¼ä½¿ç”¨æŒ‡å—](./CDPæ¨¡å¼ä½¿ç”¨æŒ‡å—.md)
- [æ•°æ®å­˜å‚¨æŒ‡å—](./data_storage_guide.md)
- [Excelå¯¼å‡ºæŒ‡å—](./excel_export_guide.md)
- [å¸¸è§é—®é¢˜](./å¸¸è§é—®é¢˜.md)
